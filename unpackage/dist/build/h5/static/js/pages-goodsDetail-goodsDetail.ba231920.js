(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-goodsDetail-goodsDetail"],{"0480":function(t,e,s){"use strict";s.r(e);var a=s("2654"),i=s.n(a);for(var n in a)"default"!==n&&function(t){s.d(e,t,(function(){return a[t]}))}(n);e["default"]=i.a},2654:function(t,e,s){"use strict";(function(t){var a=s("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(s("5530")),n=t.database(),o={data:function(){return{indicatorDots:!0,autoplay:!1,interval:2e3,duration:500,goodsId:"",loading:!1,goodsData:{img:[]},user:{},shopDialogVisible:!1,integralCountDialog:!1,integralUnit:1,integralCount:10,integralBuyNum:1}},methods:{getGoodsDetail:function(){var t=this;this.loading=!0,n.collection("goods").where({_id:this.goodsId}).get().then((function(e){t.loading=!1,e.result.data.length>0&&(t.goodsData=e.result.data[0])})).catch((function(e){t.loading=!1,t.$message.error("服务器错误")}))},getUserMessage:function(){var t=this;n.collection("user_list").where({_id:this.user._id}).get().then((function(e){console.log(e),e.result.data.length>0&&(t.user=e.result.data[0])}))},experienceOrder:function(){var t=this;if(this.user.zaomeng_integral<this.goodsData.rent){this.$message.warning("造梦积分不足，可购买");var e=setTimeout((function(){t.shopDialogVisible=!0,clearTimeout(e)}),1e3)}else!this.user.deposit||this.user.deposit<this.goodsData.deposit?this.$confirm("您的押金余额不足，将支付押金"+this.goodsData.deposit+"元，是否确定？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e=(0,i.default)({},t.user);e.deposit=(e.deposit||0)+t.goodsData.deposit,e.freeze_deposit=e.freeze_deposit||0,delete e._id,t.loading=!0,n.collection("user_list").doc(t.user._id).update(e).then((function(s){t.loading=!1,s.result.updated?(t.$message.success("支付成功"),t.user.deposit=e.deposit,t.user.freeze_deposit=e.freeze_deposit,sessionStorage.setItem("user",JSON.stringify(t.user))):t.$message.success("支付失败")})).catch((function(e){t.loading=!1,t.$message.success("支付失败")}))})).catch((function(){t.$message({type:"info",message:"取消支付"})})):this.$confirm("您将消耗"+this.goodsData.rent+"积分体验此商品，体验时长为7天，是否确定？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e=(0,i.default)({},t.user);e.zaomeng_integral=e.zaomeng_integral-t.goodsData.rent,e.freeze_deposit=e.freeze_deposit+t.goodsData.deposit,e.deposit=e.deposit-t.goodsData.deposit,delete e._id,t.loading=!0,n.collection("user_list").doc(t.user._id).update(e).then((function(s){if(t.loading=!1,s.result.updated){t.$message.success("支付成功"),t.user.zaomeng_integral=e.zaomeng_integral,t.user.freeze_deposit=e.freeze_deposit,t.user.deposit=e.deposit,sessionStorage.setItem("user",JSON.stringify(t.user));var a={user_id:t.user._id,user_phone:t.user.phone,goods_id:t.goodsData._id,goods_name:t.goodsData.name,goods_describe:t.goodsData.describe,pay_integral:t.goodsData.rent,deposit:t.goodsData.deposit,create_time:(new Date).getTime(),overdue_time:(new Date).getTime()+6048e5,istatus:"wait_send"};n.collection("user_orders").add(a).then((function(e){t.$message.success("生成订单成功")})).catch((function(e){t.$message.success("生成订单失败")}))}else t.$message.success("支付失败")})).catch((function(e){t.loading=!1,t.$message.success("支付失败")}))})).catch((function(){t.$message({type:"info",message:"取消体验"})}))},openBuyDiaog:function(t,e){this.integralUnit=t,this.integralCount=e,this.integralCountDialog=!0},submitBuy:function(){var t=this,e=this.integralCount*this.integralBuyNum,s=this.integralUnit*this.integralBuyNum;this.$confirm("您将购买"+e+"造梦积分，共花费￥"+s+"，是否确定？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.saveIntegral(e)})).catch((function(){t.$message({type:"info",message:"取消购买"})}))},saveIntegral:function(t){var e=this,s=(0,i.default)({},this.user);"vip"==s.user_type&&s.no_overdue?s.zaomeng_integral=s.zaomeng_integral+1.5*t:s.zaomeng_integral=s.zaomeng_integral+t,delete s._id,this.loading=!0,n.collection("user_list").doc(this.user._id).update(s).then((function(t){e.loading=!1,e.integralCountDialog=!1,t.result.updated?(e.$message.success("购买成功"),e.user.zaomeng_integral=s.zaomeng_integral,sessionStorage.setItem("user",JSON.stringify(e.user))):e.$message.success("购买失败")})).catch((function(t){e.loading=!1,e.$message.success("购买失败")}))}},created:function(){this.user=JSON.parse(sessionStorage.getItem("user")),this.goodsId=this.$route.query.id,this.getGoodsDetail(),this.getUserMessage()},watch:{$route:function(){this.goodsId=this.$route.query.id,this.getGoodsDetail(),this.getUserMessage()}}};e.default=o}).call(this,s("a9ff")["default"])},"56da":function(t,e,s){"use strict";var a;s.d(e,"b",(function(){return i})),s.d(e,"c",(function(){return n})),s.d(e,"a",(function(){return a}));var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-uni-view",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"goods-detail"},[s("v-uni-view",{staticClass:"detail-content"},[s("v-uni-view",{staticClass:"uni-padding-wrap"},[s("v-uni-view",{staticClass:"page-section swiper"},[s("v-uni-view",{staticClass:"page-section-spacing"},[s("v-uni-swiper",{staticClass:"swiper",attrs:{"indicator-dots":t.indicatorDots,autoplay:t.autoplay,interval:t.interval,duration:t.duration}},t._l(t.goodsData.img,(function(t,e){return s("v-uni-swiper-item",[s("v-uni-view",[s("img",{attrs:{src:t,alt:""}})])],1)})),1)],1)],1)],1),s("p",{staticClass:"detail-title"},[t._v(t._s(t.goodsData.name))]),s("p",{staticClass:"detail-describe"},[t._v(t._s(t.goodsData.describe))]),s("el-row",{staticClass:"type-lable"},t._l(t.goodsData.lable,(function(e,a){return s("el-button",{attrs:{type:"info",round:!0}},[t._v(t._s(e))])})),1),s("el-row",{staticClass:"detail-message"},[s("el-col",{attrs:{span:24}},[s("span",[t._v("专柜价格：")]),s("span",{staticStyle:{color:"#d01012"}},[t._v(t._s("￥"+t.goodsData.prich))])]),s("el-col",{attrs:{span:24}},[s("span",[t._v("体验：")]),s("span",{staticStyle:{color:"#80e010"}},[t._v(t._s(t.goodsData.rent+"积分/次"))])]),s("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:24}},[s("span",[t._v("押金：")]),s("span",{staticStyle:{color:"#ffc107"}},[t._v(t._s("￥"+t.goodsData.deposits))])]),s("el-col",{attrs:{span:12}},[s("span",[t._v("适合年龄：")]),s("span",[t._v(t._s(t.goodsData.age))])]),s("el-col",{attrs:{span:12}},[s("span",[t._v("颗粒数：")]),s("span",[t._v(t._s(t.goodsData.particles))])]),s("el-col",{attrs:{span:12}},[s("span",[t._v("发行年份：")]),s("span",[t._v(t._s(t.goodsData.issue_year+"年"))])]),"visitor"==this.user.user_type?s("el-col",{attrs:{span:12}},[s("el-button",{staticClass:"add-union"},[t._v("加入联盟")])],1):t._e()],1)],1),s("el-row",{staticClass:"bottom-btn"},[s("el-col",{attrs:{span:24}},[s("el-button",{staticStyle:{background:"#fb6600",color:"#FFFFFF"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.experienceOrder.apply(void 0,arguments)}}},[t._v("立即体验")])],1)],1),s("el-dialog",{attrs:{title:"购买造梦积分",visible:t.shopDialogVisible,width:"90%"},on:{"update:visible":function(e){arguments[0]=e=t.$handleEvent(e),t.shopDialogVisible=e}}},[s("el-row",{staticClass:"integral-shop-detail"},[s("el-col",{staticClass:"tips",attrs:{span:24}},[s("i",{staticClass:"el-icon-warning"}),t._v("联盟成员购买可获得"),s("span",[t._v("1.5倍造梦积分")])]),s("el-col",{attrs:{span:11}},[s("p",{staticClass:"top",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openBuyDiaog(1,10)}}},[s("span",[t._v("10")]),s("span",[t._v("积分")])]),s("p",{staticClass:"bottom"},[s("span",[t._v("￥")]),s("span",[t._v("1")])])]),s("el-col",{attrs:{span:11}},[s("p",{staticClass:"top",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openBuyDiaog(19,200)}}},[s("span",[t._v("200")]),s("span",[t._v("积分")])]),s("p",{staticClass:"bottom"},[s("span",[t._v("￥")]),s("span",[t._v("19")])])]),s("el-col",{attrs:{span:11}},[s("p",{staticClass:"top",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openBuyDiaog(178,2e3)}}},[s("span",[t._v("2000")]),s("span",[t._v("积分")])]),s("p",{staticClass:"bottom"},[s("span",[t._v("￥")]),s("span",[t._v("178")])])]),s("el-col",{attrs:{span:11}},[s("p",{staticClass:"top",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.openBuyDiaog(1598,2e4)}}},[s("span",[t._v("20000")]),s("span",[t._v("积分")])]),s("p",{staticClass:"bottom"},[s("span",[t._v("￥")]),s("span",[t._v("1598")])])])],1)],1),s("el-dialog",{attrs:{title:"购买数量",visible:t.integralCountDialog,width:"80%"},on:{"update:visible":function(e){arguments[0]=e=t.$handleEvent(e),t.integralCountDialog=e}}},[s("el-row",[s("el-col",{staticStyle:{"font-size":"12px","margin-bottom":"10px"},attrs:{span:24}},[s("i",{staticClass:"el-icon-warning",staticStyle:{color:"#d01012"}}),t._v("单张卡面额"+t._s(t.integralCount)+"积分")]),s("el-col",{staticStyle:{"text-align":"center"},attrs:{span:24}},[s("el-input-number",{attrs:{min:1,label:"购买数量"},model:{value:t.integralBuyNum,callback:function(e){t.integralBuyNum=e},expression:"integralBuyNum"}})],1),s("el-col",{staticStyle:{"text-align":"center","margin-top":"25px"},attrs:{span:24}},[s("el-button",{attrs:{type:"primary"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submitBuy.apply(void 0,arguments)}}},[t._v("购买")])],1)],1)],1)],1)},n=[]},cbfd:function(t,e,s){"use strict";s.r(e);var a=s("56da"),i=s("0480");for(var n in i)"default"!==n&&function(t){s.d(e,t,(function(){return i[t]}))}(n);var o,l=s("f0c5"),r=Object(l["a"])(i["default"],a["b"],a["c"],!1,null,"87bf6adc",null,!1,a["a"],o);e["default"]=r.exports}}]);